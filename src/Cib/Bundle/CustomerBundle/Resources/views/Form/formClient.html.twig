{#{{ form_enctype(form) }}#}
{{ form_label(form.clientNumber) }}
{{ form_errors(form.clientNumber) }}
{{ form_widget(form.clientNumber) }}

{{ form_label(form.clientName) }}
{{ form_errors(form.clientName) }}
{{ form_widget(form.clientName) }}

{{ form_label(form.clientFirstName) }}
{{ form_errors(form.clientFirstName) }}
{{ form_widget(form.clientFirstName) }}

{{ form_label(form.clientGender) }}
{{ form_errors(form.clientGender) }}
{{ form_widget(form.clientGender) }}

{{ form_label(form.clientBirthDate) }}
{{ form_errors(form.clientBirthDate) }}
{{ form_widget(form.clientBirthDate) }}

{{ form_label(form.clientAddress) }}
{{ form_errors(form.clientAddress) }}
{{ form_widget(form.clientAddress) }}

{{ form_label(form.clientZipCode) }}
{{ form_errors(form.clientZipCode) }}
{{ form_widget(form.clientZipCode) }}

{{ form_label(form.clientCity) }}
{{ form_errors(form.clientCity) }}
{{ form_widget(form.clientCity) }}

{{ form_label(form.homePhone) }}
{{ form_errors(form.homePhone) }}
{{ form_widget(form.homePhone) }}

{{ form_label(form.cellPhone) }}
{{ form_errors(form.cellPhone) }}
{{ form_widget(form.cellPhone) }}

{{ form_label(form.officePhone) }}
{{ form_errors(form.officePhone) }}
{{ form_widget(form.officePhone) }}

{{ form_label(form.mailAddress) }}
{{ form_errors(form.mailAddress) }}
{{ form_widget(form.mailAddress) }}

{{ form_label(form.pictureFile) }}
{{ form_errors(form.pictureFile) }}
{{ form_widget(form.pictureFile) }}

{% if client.pictureName %}
    <div>
        <img src="{{ asset(client.getWebPath()) }}" alt="photo identité" style="width:20%;height:20%"/>
    </div>
{% endif %}



<ul class="card" data-prototype="{{ form_widget(form.card.vars.prototype)|e }}">
    {% for card in form.card %}
    <li style="list-style-type: none">
        {{ form_widget(card) }}
    </li>
    {% endfor %}
</ul>
{{ form_rest(form) }}
<button type="submit" value="valider" name="valider" class="btn">Valider</button>


<script>
    // Récupère le div qui contient la collection de tags
    var collectionHolder = $('ul.card');

    // ajoute un lien « add a tag »
    var $addCardLink = $('<a href="#" class="add_card_link">Ajouter une carte</a>');
    var $newLinkLi = $('<span></span>').append($addCardLink);
//    var $removeLink = $('<li></li>').append($removeCardLink);

    jQuery(document).ready(function() {
        // ajoute l'ancre « ajouter un tag » et li à la balise ul
        collectionHolder.append($newLinkLi);
        collectionHolder.find('li').each(function() {
            addTagFormDeleteLink($(this));
        });

        $addCardLink.on('click', function(e) {
            // empêche le lien de créer un « # » dans l'URL
            e.preventDefault();

            // ajoute un nouveau formulaire tag (voir le prochain bloc de code)
            addCardForm(collectionHolder, $newLinkLi);
        });
    });

    function addCardForm(collectionHolder, $newLinkLi) {
//        alert(collectionHolder);
        // Récupère l'élément ayant l'attribut data-prototype comme expliqué plus tôt
        var prototype = collectionHolder.attr('data-prototype');
//        alert(prototype);
        // Remplace '__name__' dans le HTML du prototype par un nombre basé sur
        // la longueur de la collection courante
        var newForm = prototype.replace(/__name__/g, collectionHolder.children().length);
//        alert(collectionHolder.children().length);
//        alert(newForm);
        // Affiche le formulaire dans la page dans un li, avant le lien "ajouter un tag"
        var $newFormLi = $('<li style="list-style-type: none"></li>').append(newForm);

        $newLinkLi.before($newFormLi);
        addTagFormDeleteLink($newFormLi);
    }


    function addTagFormDeleteLink($tagFormLi) {
        var $removeFormA = $('<a href="#">Supprimer cette carte</a><div><br/></div>');
        $tagFormLi.append($removeFormA);

        $removeFormA.on('click', function(e) {
            // empêche le lien de créer un « # » dans l'URL
            e.preventDefault();

            // supprime l'élément li pour le formulaire de tag
            $tagFormLi.remove();
        });
    }
</script>